---
title: "Introduction to modelgrid"
author: "Lars Kjeldgaard"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to modelgrid}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
library(magrittr)
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

modelgrid 0.9.0 is now available on CRAN. modelgrid offers a minimalistic but 
very flexible framework to create, manage and train a portfolio of caret models.
Note, you should already be fairly familiar with the caret package before giving
`modelgrid` a spin.

This is the first official release, so below I describe the key concept behind 
`modelgrid` as well as the features of `modelgrid` divided into three main 
categories:

* Creating a model grid
* Training a model grid
* Editing a model grid

## Key concept behind the model grid
When facing a Machine Learning problem, you typically want to try out a lot of
models in order to find out, what works and what does not. But how can we manage 
these experiments in a structured, simple and transparent way? You guessed it - 
by using the `modelgrid` package (and yes, I am familiar with the `caretEnsemble`
package, but it was not exactly, what I was looking for). 

A tuning grid consists of combinations of hyperparameters for a specific model. 
A model grid is merely just an extension of that concept in the sense, that it
consists of - potentially many - models, each with their own tuning grid. 
Basically the model grid is built by providing a set of shared settings, that by
default will apply to all models within the model grid, and defining the settings
for the individual models in the model grid.

You can pre-allocate an empty model grid with the constructor function 
`model_grid` and take a look at the structure.

```{r, message = FALSE}
library(modelgrid)
mg <- model_grid()

mg
```

An object belonging to the `model_grid` class has three components:

* `shared_settings`: these are the settings, that will be shared by all models 
in the model grid by default. Generally it will make sense to fix some settings
for all models, e.g. the choice target variable, features, resampling scheme
and sometimes also preprocessing options. By providing them as shared settings
the user avoids redundant code.
* `models`: every individual model specification added to the model grid will be
an element in this list. The individual model specification consists of settings
that uniquely identify the indvidual model. If a setting has been set both as part
of the shared settings and the settings of a given individual model specification,
the setting from the individual model specification will apply for that given
model.
* `model_fits`: this element contains the fitted models (one for each individual
model specification), once the `model_grid` has been trained.

## Creating a model grid

The first natural step of setting up the model grid is to define, what settings that
should be shared by all models by default. We will use the GermanCredit dataset
from the caret package as example data and do just so with the `share_settings`
function.

```{r, message = FALSE}
library(magrittr)
library(caret)
library(dplyr)
library(purrr)
# Load data on German credit applications.  
data(GermanCredit)

# Construct empty model grid and define shared settings.
mg <-
  model_grid() %>%
  share_settings(
    y = GermanCredit[["Class"]],
    x = GermanCredit %>% select(-Class),
    preProc = "nzv",
    metric = "ROC",
    trControl = trainControl(
      method = "cv",
      number = 10,
      summaryFunction = twoClassSummary,
      classProbs = TRUE
    )
  )

purrr::map_chr(mg$shared_settings, class)
```

The `shared_settings` of the model grid are now populated. In order to complete
the model grid we must define a set of individual model specifications, that
we would like to give a shot. A common choice of baseline model could be
a simple parametric model e.g. a Generalized Linear Model. The model specification
is added to the model grid with the `add_model` function.

```{r}
mg <- 
  mg %>%
  add_model(model_name = "Logistic Regression Baseline",
            method = "glm",
            family = binomial(link = "logit"))

mg$models
```

`model_grid` requires a (unique) name for each individual model specification, so I
named this one "Logistic Regression Baseline". If the user does not provide a name,
a generic name - "Model[int]" - is generated automatically. 






s
















`modelgrid` supports both the 'x', 'y' interface to train, the formula interface and last but
not least the new powerful`recipes` interface.